#pragma checksum "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "d56cacf59f460344c0d7fddefda3e30bab4152b7"
// <auto-generated/>
#pragma warning disable 1591
namespace Oqtane.Modules.Controls
{
    #line hidden
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#line 1 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using System;

#line default
#line hidden
#line 2 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using System.Linq;

#line default
#line hidden
#line 3 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using System.Collections.Generic;

#line default
#line hidden
#line 4 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#line 6 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#line 7 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#line 8 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#line 9 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#line 11 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using Oqtane.Models;

#line default
#line hidden
#line 12 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using Oqtane.Modules;

#line default
#line hidden
#line 13 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using Oqtane.Modules.Controls;

#line default
#line hidden
#line 14 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using Oqtane.Providers;

#line default
#line hidden
#line 15 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using Oqtane.Security;

#line default
#line hidden
#line 16 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using Oqtane.Services;

#line default
#line hidden
#line 17 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using Oqtane.Shared;

#line default
#line hidden
#line 18 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using Oqtane.Themes;

#line default
#line hidden
#line 19 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using Oqtane.Themes.Controls;

#line default
#line hidden
#line 20 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using Oqtane.UI;

#line default
#line hidden
#line 21 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/_Imports.razor"
using Oqtane.Enums;

#line default
#line hidden
    public partial class FileManager : ModuleControlBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
#line 6 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
 if (_folders != null)
{

#line default
#line hidden
            __builder.AddContent(0, "    ");
            __builder.OpenElement(1, "div");
            __builder.AddAttribute(2, "id", 
#line 8 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
              Id

#line default
#line hidden
            );
            __builder.AddAttribute(3, "class", "container-fluid px-0");
            __builder.AddMarkupContent(4, "\n        ");
            __builder.OpenElement(5, "div");
            __builder.AddAttribute(6, "class", "row");
            __builder.AddMarkupContent(7, "\n            ");
            __builder.OpenElement(8, "div");
            __builder.AddAttribute(9, "class", "col");
            __builder.AddMarkupContent(10, "\n");
#line 11 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                 if (ShowFolders || FolderId <= 0)
                {

#line default
#line hidden
            __builder.AddContent(11, "                    ");
            __builder.OpenElement(12, "div");
            __builder.AddMarkupContent(13, "\n                        ");
            __builder.OpenElement(14, "select");
            __builder.AddAttribute(15, "class", "form-control");
            __builder.AddAttribute(16, "onchange", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.ChangeEventArgs>(this, 
#line 14 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                                (e => FolderChanged(e))

#line default
#line hidden
            ));
            __builder.AddMarkupContent(17, "\n");
#line 15 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                             if (string.IsNullOrEmpty(Folder))
                            {

#line default
#line hidden
            __builder.AddContent(18, "                                ");
            __builder.OpenElement(19, "option");
            __builder.AddAttribute(20, "value", "-1");
            __builder.AddContent(21, "<Select Folder>");
            __builder.CloseElement();
            __builder.AddMarkupContent(22, "\n");
#line 18 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                            }

#line default
#line hidden
#line 19 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                             foreach (Folder folder in _folders)
                            {
                                if (folder.FolderId == FolderId)
                                {

#line default
#line hidden
            __builder.AddContent(23, "                                    ");
            __builder.OpenElement(24, "option");
            __builder.AddAttribute(25, "value", 
#line 23 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                     folder.FolderId

#line default
#line hidden
            );
            __builder.AddAttribute(26, "selected", true);
            __builder.AddContent(27, 
#line 23 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                                                  new string('-', folder.Level * 2)

#line default
#line hidden
            );
            __builder.AddContent(28, 
#line 23 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                                                                                      folder.Name

#line default
#line hidden
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(29, "\n");
#line 24 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                }
                                else
                                {

#line default
#line hidden
            __builder.AddContent(30, "                                    ");
            __builder.OpenElement(31, "option");
            __builder.AddAttribute(32, "value", 
#line 27 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                     folder.FolderId

#line default
#line hidden
            );
            __builder.AddContent(33, 
#line 27 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                                         new string('-', folder.Level * 2)

#line default
#line hidden
            );
            __builder.AddContent(34, 
#line 27 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                                                                             folder.Name

#line default
#line hidden
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(35, "\n");
#line 28 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                }
                            }

#line default
#line hidden
            __builder.AddContent(36, "                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(37, "\n                    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(38, "\n");
#line 32 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                }

#line default
#line hidden
#line 33 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                 if (ShowFiles)
                {

#line default
#line hidden
            __builder.AddContent(39, "                    ");
            __builder.OpenElement(40, "div");
            __builder.AddMarkupContent(41, "\n                        ");
            __builder.OpenElement(42, "select");
            __builder.AddAttribute(43, "class", "form-control");
            __builder.AddAttribute(44, "onchange", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.ChangeEventArgs>(this, 
#line 36 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                                (e => FileChanged(e))

#line default
#line hidden
            ));
            __builder.AddMarkupContent(45, "\n                            ");
            __builder.OpenElement(46, "option");
            __builder.AddAttribute(47, "value", "-1");
            __builder.AddContent(48, "<Select File>");
            __builder.CloseElement();
            __builder.AddMarkupContent(49, "\n");
#line 38 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                             foreach (File file in _files)
                            {
                                if (file.FileId == FileId)
                                {

#line default
#line hidden
            __builder.AddContent(50, "                                    ");
            __builder.OpenElement(51, "option");
            __builder.AddAttribute(52, "value", 
#line 42 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                     file.FileId

#line default
#line hidden
            );
            __builder.AddAttribute(53, "selected", true);
            __builder.AddContent(54, 
#line 42 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                                              file.Name

#line default
#line hidden
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(55, "\n");
#line 43 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                }
                                else
                                {

#line default
#line hidden
            __builder.AddContent(56, "                                    ");
            __builder.OpenElement(57, "option");
            __builder.AddAttribute(58, "value", 
#line 46 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                     file.FileId

#line default
#line hidden
            );
            __builder.AddContent(59, 
#line 46 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                                     file.Name

#line default
#line hidden
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(60, "\n");
#line 47 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                }
                            }

#line default
#line hidden
            __builder.AddContent(61, "                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(62, "\n                    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(63, "\n");
#line 51 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                }

#line default
#line hidden
#line 52 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                 if (ShowUpload && _haseditpermission)
                {

#line default
#line hidden
            __builder.AddContent(64, "                    ");
            __builder.OpenElement(65, "div");
            __builder.AddMarkupContent(66, "\n");
#line 55 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                         if (UploadMultiple)
                        {

#line default
#line hidden
            __builder.AddContent(67, "                            ");
            __builder.OpenElement(68, "input");
            __builder.AddAttribute(69, "type", "file");
            __builder.AddAttribute(70, "id", 
#line 57 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                    _fileinputid

#line default
#line hidden
            );
            __builder.AddAttribute(71, "name", "file");
            __builder.AddAttribute(72, "accept", 
#line 57 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                                                       _filter

#line default
#line hidden
            );
            __builder.AddAttribute(73, "multiple", true);
            __builder.CloseElement();
            __builder.AddMarkupContent(74, "\n");
#line 58 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                        }
                        else
                        {

#line default
#line hidden
            __builder.AddContent(75, "                            ");
            __builder.OpenElement(76, "input");
            __builder.AddAttribute(77, "type", "file");
            __builder.AddAttribute(78, "id", 
#line 61 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                    _fileinputid

#line default
#line hidden
            );
            __builder.AddAttribute(79, "name", "file");
            __builder.AddAttribute(80, "accept", 
#line 61 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                                                       _filter

#line default
#line hidden
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(81, "\n");
#line 62 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                        }

#line default
#line hidden
            __builder.AddContent(82, "                        ");
            __builder.OpenElement(83, "span");
            __builder.AddAttribute(84, "id", 
#line 63 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                   _progressinfoid

#line default
#line hidden
            );
            __builder.CloseElement();
            __builder.OpenElement(85, "progress");
            __builder.AddAttribute(86, "id", 
#line 63 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                                          _progressbarid

#line default
#line hidden
            );
            __builder.AddAttribute(87, "style", "width: 150px; visibility: hidden;");
            __builder.CloseElement();
            __builder.AddMarkupContent(88, "\n                        ");
            __builder.OpenElement(89, "span");
            __builder.AddAttribute(90, "class", "float-right");
            __builder.AddMarkupContent(91, "\n                            ");
            __builder.OpenElement(92, "button");
            __builder.AddAttribute(93, "type", "button");
            __builder.AddAttribute(94, "class", "btn btn-success");
            __builder.AddAttribute(95, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#line 65 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                                                    UploadFile

#line default
#line hidden
            ));
            __builder.AddContent(96, "Upload");
            __builder.CloseElement();
            __builder.AddMarkupContent(97, "\n");
#line 66 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                             if (ShowFiles && GetFileId() != -1)
                            {

#line default
#line hidden
            __builder.AddContent(98, "                                ");
            __builder.OpenElement(99, "button");
            __builder.AddAttribute(100, "type", "button");
            __builder.AddAttribute(101, "class", "btn btn-danger");
            __builder.AddAttribute(102, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#line 68 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                                                                                       DeleteFile

#line default
#line hidden
            ));
            __builder.AddContent(103, "Delete");
            __builder.CloseElement();
            __builder.AddMarkupContent(104, "\n");
#line 69 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                            }

#line default
#line hidden
            __builder.AddContent(105, "                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(106, "\n                    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(107, "\n");
#line 72 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                }

#line default
#line hidden
            __builder.AddContent(108, "                ");
            __builder.AddContent(109, 
#line 73 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                  (MarkupString) _message

#line default
#line hidden
            );
            __builder.AddMarkupContent(110, "\n            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(111, "\n");
#line 75 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
             if (_image != string.Empty)
            {

#line default
#line hidden
            __builder.AddContent(112, "                ");
            __builder.OpenElement(113, "div");
            __builder.AddAttribute(114, "class", "col-auto");
            __builder.AddMarkupContent(115, "\n                    ");
            __builder.AddContent(116, 
#line 78 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
                      (MarkupString) _image

#line default
#line hidden
            );
            __builder.AddMarkupContent(117, "\n                ");
            __builder.CloseElement();
            __builder.AddMarkupContent(118, "\n");
#line 80 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
            }

#line default
#line hidden
            __builder.AddContent(119, "        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(120, "\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(121, "\n");
#line 83 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
}

#line default
#line hidden
        }
        #pragma warning restore 1998
#line 85 "/Users/cam/Desktop/oqtane/oqtane-theme-test/Oqtane.Client/Modules/Controls/FileManager.razor"
       
    private string _id;
    private List<Folder> _folders;
    private List<File> _files = new List<File>();
    private string _fileinputid = string.Empty;
    private string _progressinfoid = string.Empty;
    private string _progressbarid = string.Empty;
    private string _filter = "*";
    private bool _haseditpermission = false;
    private string _message = string.Empty;
    private string _image = string.Empty;
    private string _guid;

    [Parameter]
    public string Id { get; set; } // optional - for setting the id of the FileManager component for accessibility

    [Parameter]
    public string Folder { get; set; } // optional - for setting a specific folder by default

    [Parameter]
    public int FolderId { get; set; } = -1; // optional - for setting a specific folderid by default

    [Parameter]
    public bool ShowFiles { get; set; } = true; // optional - for indicating whether a list of files should be displayed - default is true

    [Parameter]
    public bool ShowUpload { get; set; } = true; // optional - for indicating whether a Upload controls should be displayed - default is true

    [Parameter]
    public bool ShowFolders { get; set; } = true; // optional - for indicating whether a list of folders should be displayed - default is true

    [Parameter]
    public int FileId { get; set; } = -1; // optional - for setting a specific file by default

    [Parameter]
    public string Filter { get; set; } // optional - comma delimited list of file types that can be selected or uploaded ie. "jpg,gif"

    [Parameter]
    public bool UploadMultiple { get; set; } = false; // optional - enable multiple file uploads - default false

    protected override async Task OnInitializedAsync()
    {
        if (!string.IsNullOrEmpty(Id))
        {
            _id = Id;
        }

        if (!string.IsNullOrEmpty(Folder))
        {
            _folders = new List<Folder> { new Folder { FolderId = -1, Name = Folder } };
            FolderId = -1;
        }
        else
        {
            _folders = await FolderService.GetFoldersAsync(ModuleState.SiteId);
        }

        if (FileId != -1)
        {
            File file = await FileService.GetFileAsync(FileId);
            if (file != null)
            {
                FolderId = file.FolderId;
            }
            else
            {
                FileId = -1; // file does not exist
            }
        }
        await SetImage();

        if (!string.IsNullOrEmpty(Filter))
        {
            _filter = "." + Filter.Replace(",", ",.");
        }

        await GetFiles();

        // create unique id for component
        _guid = Guid.NewGuid().ToString("N");
        _fileinputid = _guid + "FileInput";
        _progressinfoid = _guid + "ProgressInfo";
        _progressbarid = _guid + "ProgressBar";
    }

    private async Task GetFiles()
    {
        _haseditpermission = false;
        if (!string.IsNullOrEmpty(Folder))
        {
            _haseditpermission = UserSecurity.IsAuthorized(PageState.User, Constants.HostRole);
            _files = await FileService.GetFilesAsync(Folder);
        }
        else
        {
            Folder folder = _folders.FirstOrDefault(item => item.FolderId == FolderId);
            if (folder != null)
            {
                _haseditpermission = UserSecurity.IsAuthorized(PageState.User, PermissionNames.Edit, folder.Permissions);
                _files = await FileService.GetFilesAsync(FolderId);
            }
            else
            {
                _haseditpermission = false;
                _files = new List<File>();
            }
        }
        if (_filter != "*")
        {
            List<File> filtered = new List<File>();
            foreach (File file in _files)
            {
                if (_filter.ToUpper().IndexOf("." + file.Extension.ToUpper()) != -1)
                {
                    filtered.Add(file);
                }
            }
            _files = filtered;
        }
    }

    private async Task FolderChanged(ChangeEventArgs e)
    {
        _message = string.Empty;
        try
        {
            FolderId = int.Parse((string)e.Value);
            await GetFiles();
            FileId = -1;
            _image = string.Empty;
            StateHasChanged();
        }
        catch (Exception ex)
        {
            await logger.LogError(ex, "Error Loading Files {Error}", ex.Message);
            _message = "<br /><div class=\"alert alert-danger\" role=\"alert\">Error Loading Files</div>";
        }
    }

    private async Task FileChanged(ChangeEventArgs e)
    {
        _message = string.Empty;
        FileId = int.Parse((string)e.Value);

        await SetImage();
        StateHasChanged();
    }

    private async Task SetImage()
    {
        _image = string.Empty;
        if (FileId != -1)
        {
            File file = await FileService.GetFileAsync(FileId);
            if (file != null && file.ImageHeight != 0 && file.ImageWidth != 0)
            {
                var maxwidth = 200;
                var maxheight = 200;

                var ratioX = (double)maxwidth / (double)file.ImageWidth;
                var ratioY = (double)maxheight / (double)file.ImageHeight;
                var ratio = ratioX < ratioY ? ratioX : ratioY;

                _image = "<img src=\"" + ContentUrl(FileId) + "\" alt=\"" + file.Name +
                         "\" width=\"" + Convert.ToInt32(file.ImageWidth * ratio).ToString() +
                         "\" height=\"" + Convert.ToInt32(file.ImageHeight * ratio).ToString() + "\" />";
            }
        }
    }

    private async Task UploadFile()
    {
        var interop = new Interop(JSRuntime);
        var upload = await interop.GetFiles(_fileinputid);
        if (upload.Length > 0)
        {
            try
            {
                string result;
                if (!string.IsNullOrEmpty(Folder))
                {
                    result = await FileService.UploadFilesAsync(Folder, upload, _guid);
                }
                else
                {
                    result = await FileService.UploadFilesAsync(FolderId, upload, _guid);
                }

                if (result == string.Empty)
                {
                    await logger.LogInformation("File Upload Succeeded {Files}", upload);
                    _message = "<br /><div class=\"alert alert-success\" role=\"alert\">File Upload Succeeded</div>";
                    await GetFiles();

                    if (upload.Length == 1)
                    {
                        var file = _files.Where(item => item.Name == upload[0]).FirstOrDefault();
                        if (file != null)
                        {
                            FileId = file.FileId;
                            await SetImage();
                        }
                    }
                    StateHasChanged();
                }
                else
                {
                    await logger.LogError("File Upload Failed For {Files}", result.Replace(",", ", "));
                    _message = "<br /><div class=\"alert alert-danger\" role=\"alert\">File Upload Failed</div>";
                }
            }
            catch (Exception ex)
            {
                await logger.LogError(ex, "File Upload Failed {Error}", ex.Message);
                _message = "<br /><div class=\"alert alert-danger\" role=\"alert\">File Upload Failed</div>";
            }
        }
        else
        {
            _message = "<br /><div class=\"alert alert-warning\" role=\"alert\">You Have Not Selected A File To Upload</div>";
        }
    }

    private async Task DeleteFile()
    {
        _message = string.Empty;

        try
        {
            await FileService.DeleteFileAsync(FileId);
            await logger.LogInformation("File Deleted {File}", FileId);
            _message = "<br /><div class=\"alert alert-success\" role=\"alert\">File Deleted</div>";
            await GetFiles();
            FileId = -1;
            await SetImage();
            StateHasChanged();
        }
        catch (Exception ex)
        {
            await logger.LogError(ex, "Error Deleting File {File} {Error}", FileId, ex.Message);
            _message = "<br /><div class=\"alert alert-danger\" role=\"alert\">Error Deleting File</div>";
        }
    }

    public int GetFileId() => FileId;


#line default
#line hidden
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IFileService FileService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IFolderService FolderService { get; set; }
    }
}
#pragma warning restore 1591
